{% extends 'base.html' %}

{% block title %}RAD Remedy - Home{% endblock %}
{% block head_text %}RAD Remedy{% endblock %}

{% block head %}
  <link href="{{ url_for('static', filename='css/select2.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/select2-bootstrap.min.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
	<h2>Search RAD's Database:</h2>
	<div class="home-search text-center">
		
		<form class="search" role="search" action="{{ url_for('remedy.resource_search') }}" method="GET">
	    <div class="form-group ">
	      <input type="text" name="search" class="form-control form-remedy" 
	        placeholder="Search for providers by name, location, or specialty" />
	    </div>
	    <div class="form-group">
	      <label for="search-addr">near</label>
				<input type="text" name="addr" id="search-addr" class="form-control form-remedy" 
					placeholder="Address" value="{{ current_user.default_location|d('') if current_user.default_location != None }}" />
			</div>
			<div class="form-group"> 
				<label for="dist">within</label>
				<select id="dist" name="dist" class="form-control form-remedy">
					<option value="-1">Anywhere</option>
					<option value="5">5 mi</option>
					<option value="10">10 mi</option>
					<option value="25" selected="selected">25 mi</option>
					<option value="50">50 mi</option>
					<option value="100">100 mi</option>
				</select>
				<input type="hidden" name="lat" id="search-lat" 
					value="{{ current_user.default_latitude if current_user.default_latitude != None }}" />
				<input type="hidden" name="long" id="search-long" 
					value="{{ current_user.default_longitude if current_user.default_longitude != None }}" />
	    </div>
			{% if categories %}
			<div class="form-group">
				<select name="categories" multiple="multiple" placeholder="Categories"
					class="form-control form-remedy">
					{% for c in categories %}
						<option value="{{ c.id }}"
						{% if c.description %} title="{{ c.description }}" {% endif %}>
						{{ c.name }}</option>
					{% endfor %}
				</select>
			</div>
			{% endif %}	    
	    <button type="submit" class="btn search home-search-btn" title="Search">
	      Search
	    </button>
    </form>
	</div>

<h2>Recently Added To RAD</h2>
<div class="row">
	{% for r in recently_added %}
		<div class="col-sm-6 col-md-4 col-xs-12 {% if loop.index > 6 %}recent-provider-toggle{% endif %}"
			{% if loop.index > 6 %}style="display: none;"{% endif %}>
			<div class="panel recently-added">
				<div class="panel-heading">
			    <h3 class="panel-title">
						Provider		    	
			    </h3>
			  </div>
			  <div class="panel-body">
			  	<p>
						<a href="{{ url_for('remedy.resource', resource_id=r.id) }}">
							{{ r.name|truncate(60) }}
						</a>
					</p>
			  </div>
			  <div class="panel-footer">
					Added: {{ r.date_created.strftime('%m/%d/%Y') }}
			  </div>
			</div>
		</div>
	{% endfor %}
</div>
<div class="row">
	<div class="col-md-12">
		<button id="recent-provider-moreless" aria-role="button" class="btn btn-link btn-lg center-block">
			<span class="recent-provider-toggle">
				<span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>&nbsp;
				Show More
			</span>
			<span class="recent-provider-toggle" style="display: none;">
				<span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span>&nbsp; 
				Show Fewer
			</span>			
		</button>
	</div>
</div>
{% endblock %}

{% block scripts %}
{{ macros.gmaps_script(false, 'search-addr', 'search-lat', 'search-long') }}
<script src="{{ url_for('static', filename='js/select2.min.js') }}"></script>
<script type="text/javascript">
	$(function () {
		var categorySelect = $("select[name='categories']"), 
			selectVal = categorySelect.val();

		categorySelect.select2().val(selectVal);

		$("#recent-provider-moreless").click(function () {
			$(".recent-provider-toggle").toggle();
		})
	}); 
</script>
{% endblock %}
