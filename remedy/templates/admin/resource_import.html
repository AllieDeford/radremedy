{% extends 'admin/master.html' %}

{% block body %}
{{ super() }}
<h2>Import Resources from {{ path }}</h2>

{# Important Flask-Admin note - it currently uses bootstrap 2.3,
	not Bootstrap 3, so we have to use row-fluid and span12 (the old names
	for the grid classes) #}
<div class="container-fluid">
	<div class="row row-fluid">
		<div class="span12">
			<form action="{{ url_for('resourceimportview.index', file=path) }}" method="POST">
				<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
				<table class="table table-striped table-bordered table-condensed table-hover">
			    <thead>
		        <tr>
		        	<th>
								&nbsp;
		        	</th>
		        	{% for field_name in resource_fields %}
							<th>
								{{ field_name|capitalize }}
							</th>
							{% endfor %}
		        </tr>
			    </thead>
			    <tbody>
					{% for wrapped_res in resources %}
						<tr
              {% if not wrapped_res.valid %}
              class="error"
              {% elif wrapped_res.has_dup_name == True %}
              class="warning"
              {% endif %}
            >
							<td>
								<input type="checkbox" name="rowid" value="{{ wrapped_res.row_index }}"
									{% if wrapped_res.valid == False %} 
									disabled="disabled"
									{% elif wrapped_res.has_dup_name == False %}
									checked="checked"
									{% endif %}
								/>
							</td>
		        	{% for field_name in resource_fields %}
							<td>
								{% set field_val = wrapped_res.resource|attr(field_name) %}
								{% if field_val %}
									{% if field_val is string() %}
										{# Truncate string fields #}
										{{ field_val|truncate(100) }}
									{% elif field_val is sequence() %}
										{# Turn sequences into comma-separated lists. #}
										{{ field_val|join(", ")|truncate(100) }}
									{% else %}
										{{ field_val }}
									{% endif %}
								{% endif %}
							</td>
							{% endfor %}
						</tr>
					{% endfor %}
			    </tbody>
				</table>

        <h3>
          Import Options
        </h3>
			  <div class="checkbox">
			    <label>
			      <input type="checkbox" name="create_categories" /> Create new categories
			    </label>
			  </div>
			  <div class="checkbox">
			    <label>
			      <input type="checkbox" name="delete_after" /> Delete the file after importing
			    </label>
			  </div>

				<div class="form-group">
					<button type="submit" class="btn btn-lg btn-danger"
						onclick='return confirm("Are you sure you want to start the import?");'>
						Import
					</button>
					<a class="btn btn-lg" href="{{ url_for('resourceimportfilesview.index') }}">
						Cancel
					</a>
				</div>
			</form>
		</div>
	</div>
</div>
{% endblock %}